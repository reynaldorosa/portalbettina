/**
 * TESTE DE INTEGRAÃ‡ÃƒO - AUTISM COGNITIVE ANALYSIS
 * Verifica se os mÃ³dulos do autismCognitiveAnalysis estÃ£o corretamente configurados
 * e integrados no SystemOrchestrator
 */

import autismCognitiveAnalyzer from './src/utils/autismCognitiveAnalysis/autismCognitiveAnalyzer.js'
import { AdvancedAnalysisOrchestrator } from './src/utils/autismCognitiveAnalysis/advancedAnalysisOrchestrator.js'
import AdvancedSupportCalculator from './src/utils/autismCognitiveAnalysis/advancedSupportCalculations.js'
import { AutismAssessmentHelpers } from './src/utils/autismCognitiveAnalysis/autismAssessmentHelpers.js'
import { featureFlags, isFeatureEnabled } from './src/utils/autismCognitiveAnalysis/featureFlags.js'
import neuropedagogicalAnalyzer from './src/utils/autismCognitiveAnalysis/neuropedagogicalInsights.js'

/**
 * Testa configuraÃ§Ã£o dos mÃ³dulos do autismCognitiveAnalysis
 */
async function testAutismCognitiveIntegration() {
  console.log('ðŸ§  TESTE DE INTEGRAÃ‡ÃƒO - AUTISM COGNITIVE ANALYSIS')
  console.log('=' .repeat(60))

  try {
    // 1. Testar autismCognitiveAnalyzer
    console.log('ðŸ”¬ Testando autismCognitiveAnalyzer...')
    await autismCognitiveAnalyzer.initialize()
    console.log('âœ… autismCognitiveAnalyzer inicializado:', autismCognitiveAnalyzer.isInitialized)

    // 2. Testar AdvancedAnalysisOrchestrator
    console.log('ðŸŽ›ï¸ Testando AdvancedAnalysisOrchestrator...')
    const advancedOrchestrator = new AdvancedAnalysisOrchestrator()
    console.log('âœ… AdvancedAnalysisOrchestrator criado:', !!advancedOrchestrator)

    // 3. Testar AdvancedSupportCalculator
    console.log('ðŸ“Š Testando AdvancedSupportCalculator...')
    const supportCalculator = new AdvancedSupportCalculator()
    await supportCalculator.initialize()
    console.log('âœ… AdvancedSupportCalculator inicializado:', supportCalculator.isInitialized)

    // 4. Testar feature flags
    console.log('ðŸ Testando feature flags...')
    console.log('âœ… Feature flags carregadas:', Object.keys(featureFlags).length, 'flags')
    console.log('ðŸŽ¯ Features habilitadas importantes:')
    console.log('   - enableAdvancedCognitiveAnalysis:', isFeatureEnabled('enableAdvancedCognitiveAnalysis'))
    console.log('   - enableTherapeuticRecommendations:', isFeatureEnabled('enableTherapeuticRecommendations'))
    console.log('   - enableAutismSpecificAlgorithms:', isFeatureEnabled('enableAutismSpecificAlgorithms'))
    console.log('   - enableSystemOrchestration:', isFeatureEnabled('enableSystemOrchestration'))

    // 5. Testar neuropedagogicalAnalyzer
    console.log('ðŸ§  Testando neuropedagogicalAnalyzer...')
    await neuropedagogicalAnalyzer.initialize()
    console.log('âœ… neuropedagogicalAnalyzer inicializado:', neuropedagogicalAnalyzer.isInitialized)

    // 6. Teste de anÃ¡lise cognitiva bÃ¡sica
    console.log('ðŸŽ¯ Executando anÃ¡lise cognitiva de teste...')
    const testSessionData = {
      sessionId: 'test-001',
      attempts: 10,
      errors: 2,
      sessionDuration: 300000,
      activityType: 'matching-game',
      difficulty: 'medium',
      responseTimeProgression: [2000, 1800, 1600, 1500, 1400],
      helpRequests: 1,
      taskCompleted: true,
      accuracy: 0.8,
      visualProcessing: 0.7,
      auditoryProcessing: 0.6,
      attention: 0.75
    }

    const testUserProfile = {
      age: 8,
      diagnosis: 'autism',
      communicationLevel: { level: 2 },
      sensoryProfile: {
        visual: { threshold: 0.3 },
        auditory: { threshold: 0.8 }
      }
    }

    // Teste do autismCognitiveAnalyzer
    const adaptations = autismCognitiveAnalyzer.calculateAutismAdaptations('test-user', testSessionData, testUserProfile)
    console.log('âœ… AdaptaÃ§Ãµes calculadas:', !!adaptations, '- ConfianÃ§a:', adaptations?.confidence || 'N/A')

    // Teste do supportCalculator
    const visualSupport = supportCalculator.calculateVisualSupportLevel({
      visualProcessingSpeed: 0.4,
      visualAttention: 0.6,
      sensorySensitivity: 0.7,
      needsHighContrast: true
    })
    console.log('âœ… Suporte visual calculado:', visualSupport.level, '- Score:', visualSupport.score.toFixed(2))

    // Teste do neuropedagogicalAnalyzer
    const comprehensiveReport = neuropedagogicalAnalyzer.generateComprehensiveReport(testSessionData)
    console.log('âœ… RelatÃ³rio abrangente gerado:', !!comprehensiveReport, '- Insights:', comprehensiveReport?.therapeuticRecommendations?.length || 0)

    // 7. Verificar integraÃ§Ã£o com SystemOrchestrator
    console.log('ðŸ”— Verificando integraÃ§Ã£o com SystemOrchestrator...')
    
    // Importar o SystemOrchestrator
    let systemOrchestratorIntegrated = false
    try {
      const { SystemOrchestrator } = await import('./src/utils/core/SystemOrchestrator.js')
      
      // Verificar se hÃ¡ referÃªncias aos mÃ³dulos autism cognitive
      const orchestratorCode = await import('fs').then(fs => 
        fs.promises.readFile('./src/utils/core/SystemOrchestrator.js', 'utf8')
      )
      
      systemOrchestratorIntegrated = 
        orchestratorCode.includes('autismCognitiveAnalysis') ||
        orchestratorCode.includes('AdvancedAnalysisOrchestrator') ||
        orchestratorCode.includes('neuropedagogicalAnalyzer')
        
      console.log('ðŸ” SystemOrchestrator integraÃ§Ã£o detectada:', systemOrchestratorIntegrated)
      
    } catch (error) {
      console.log('âš ï¸ Erro ao verificar integraÃ§Ã£o SystemOrchestrator:', error.message)
    }

    // 8. Status final
    console.log('\nðŸ“‹ RESUMO DA CONFIGURAÃ‡ÃƒO:')
    console.log('=' .repeat(60))
    console.log('âœ… autismCognitiveAnalyzer: CONFIGURADO')
    console.log('âœ… AdvancedAnalysisOrchestrator: CONFIGURADO')
    console.log('âœ… AdvancedSupportCalculator: CONFIGURADO')
    console.log('âœ… Feature Flags: CONFIGURADAS')
    console.log('âœ… neuropedagogicalAnalyzer: CONFIGURADO')
    console.log('âœ… AutismAssessmentHelpers: CONFIGURADO')
    
    if (systemOrchestratorIntegrated) {
      console.log('âœ… SystemOrchestrator: INTEGRADO')
    } else {
      console.log('âš ï¸ SystemOrchestrator: NECESSITA INTEGRAÃ‡ÃƒO')
    }

    console.log('\nðŸŽ¯ RECOMENDAÃ‡Ã•ES:')
    if (!systemOrchestratorIntegrated) {
      console.log('ðŸ“Œ Integrar mÃ³dulos autismCognitiveAnalysis no SystemOrchestrator')
      console.log('ðŸ“Œ Adicionar imports dos mÃ³dulos avanÃ§ados')
      console.log('ðŸ“Œ Ativar feature flags no orquestrador principal')
    } else {
      console.log('âœ… Todos os mÃ³dulos estÃ£o corretamente configurados!')
    }

    return {
      success: true,
      modulesConfigured: true,
      systemOrchestratorIntegrated,
      featuresEnabled: isFeatureEnabled('enableAdvancedCognitiveAnalysis'),
      testResults: {
        autismCognitiveAnalyzer: !!adaptations,
        supportCalculator: !!visualSupport,
        neuropedagogicalAnalyzer: !!comprehensiveReport
      }
    }

  } catch (error) {
    console.error('âŒ Erro no teste de integraÃ§Ã£o:', error)
    return {
      success: false,
      error: error.message
    }
  }
}

// Executar o teste
testAutismCognitiveIntegration()
  .then(result => {
    console.log('\nðŸ TESTE CONCLUÃDO')
    console.log('Resultado:', result.success ? 'SUCESSO' : 'FALHA')
    process.exit(result.success ? 0 : 1)
  })
  .catch(error => {
    console.error('ðŸ’¥ Erro fatal no teste:', error)
    process.exit(1)
  })
